
# ã‚¼ãƒ­ã‹ã‚‰å§‹ã‚ã‚‹è‡ªä½œOS

## OSã¨ã¯

### OSã®ä¸‰ã¤ã®å´é¢
1. **ã‚¢ãƒ—ãƒªã«å¯¾ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹**  
   ã‚¢ãƒ—ãƒªã¨å‘¨è¾ºæ©Ÿå™¨ãªã©ã®é–“ã‚’ä»²ä»‹ã™ã‚‹
2. **è¨ˆç®—è³‡æºã®åˆ†é…**  
   CPUã®å‡¦ç†ã‚’ã©ã‚Œã‚’å„ªå…ˆã•ã›ã‚‹ã‹ç®¡ç†ã™ã‚‹
3. **äººé–“ã«å¯¾ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹**  
   å„ã‚¢ãƒ—ãƒªã«çµ±ä¸€ã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã•ã›ã‚‹

### ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹
- **POSIX**  
  UNIXã§ä½¿ã‚ã‚Œã‚‹ã€‚Cã®å‡¦ç†ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
- **Windows API**  
  Microsoftç‹¬è‡ªã®OSã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹

-> æœ¬æ›¸ã§ã¯æ—¢å­˜ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾æ‹ ã—ãªã„ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã«ã™ã‚‹

---

## ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ï¼ˆç¬¬ä¸€ç« ã€œç¬¬ä¸‰ç« ï¼‰

### ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ã¨ã¯
- ã€ŒOSã‚’ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã¿èµ·å‹•ã•ã›ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€ã®ã“ã¨
- CPUã¯ åŸå‰‡ã¨ã—ã¦RAM(ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒª)ä¸Šã®å‘½ä»¤ã—ã‹å®Ÿè¡Œã§ããªã„ã€‚
- åŸºæœ¬ã¯OSãŒROM(ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸)ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿,ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’RAMã«æ¸¡ã—ã¦ã„ã‚‹
- PCèµ·å‹•æ™‚ã¯ä¾‹å¤–ã§ã€PCã¯é›»æºæŠ•å…¥ç›´å¾ŒOSã®å­˜åœ¨ã™ã‚‰çŸ¥ã‚‰ãªã„ã®ã§ã€ROMã«ã€OSã‚’ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã¿èµ·å‹•ã•ã›ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ (ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€)ã‚’å…¥ã‚Œã¦ãŠãå¿…è¦ãŒã‚ã‚‹

### hello, world ã™ã‚‹ãƒã‚¤ãƒŠãƒªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã‚‹
- ãƒã‚¤ãƒŠãƒªã‚³ãƒ¼ãƒ‰ã«ã‚‚ã€ã©ã®ãƒ«ãƒ¼ãƒ«ã§æ›¸ãã‹ã€ãŒã‚ã‚‹

-> æœ¬æ›¸ã§ã¯ã€x86-64 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒï¼ˆ64ãƒ“ãƒƒãƒˆCPUå‘ã‘ã®æ©Ÿæ¢°èªã®ãƒ«ãƒ¼ãƒ«ã®ä¸€ã¤ï¼‰ã§æ›¸ã„ãŸ

### ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢
- PCã®é›»æºã‚’å…¥ã‚ŒãŸç›´å¾Œã«æœ€åˆã«å‹•ãã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã“ã¨
- æ˜”ã®åæ®‹ã§ã€ä»Šã§ã‚‚ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢å…¨ä½“ã‚’BIOSã¨å‘¼ã¶å ´åˆã‚‚ã‚ã‚‹

1. **BIOS**  
   1980å¹´ä»£PCã®ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢
2. **EFI**  
   BIOSã®è¨­è¨ˆã‚’æ¨ã¦ã¦ä½œã‚Šç›´ã—ãŸ
3. **UEFI**  
   EFIã‚’æ¨™æº–åŒ–ã—ã€ç¾åœ¨åºƒãæ¡ç”¨ã•ã‚Œã¦ã„ã‚‹

###  hello, world ã™ã‚‹ãƒã‚¤ãƒŠãƒªã‚³ãƒ¼ãƒ‰ã‚’USBã«æ›¸ãè¾¼ã¿ã€EFIã§èµ·å‹•
1. MACã§USBã‚’åˆæœŸåŒ–ã—èµ·å‹•æ™‚ã«EFIãŒå‘¼ã°ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸ
    sudo diskutil partitionDisk disk4 GPT MS-DOS UEFIUSB 100% 

2. èµ·å‹•ã™ã‚‹PCã§ã€èµ·å‹•æ™‚ã«USBãŒå‘¼ã°ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸ
    - Fujitsuãƒãƒ¼ãƒˆPCã®BIOSç”»é¢ã§Boot->UEFI Priorities->Boot Option #1ã‚’ELECOM MF...(ã‚³ãƒ¼ãƒ‰å…¥ã‚ŠUSB)ã«å¤‰æ›´
    - Security->Secure Boot->Disabledã«å¤‰æ›´
- è£œè¶³
    - ãƒ¬ãƒƒãƒ„ãƒãƒ¼ãƒˆã§ã‚‚F2é€£æ‰“->BIOSç”»é¢ã§å†èµ·å‹• ã§ã„ã‘ãŸ
    - GPTã«èã„ãŸã‚‰åˆ¥ã®å ´æ‰€ã«ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜ã—ã¦ã„ã¦å‹•ã‹ãªã‹ã£ãŸãŒã€https://qiita.com/ktamido/items/56b3427827894021ed73 ã‚’å‚è€ƒã«ã—ã¦ã‚„ã‚Œã°å‹•ã„ãŸâ‡©
            
            mkdir -p ~/mnt/esp

            sudo diskutil mount -mountPoint ~/mnt/esp /dev/disk4s1

            mkdir -p ~/mnt/esp/EFI/BOOT
            cp BOOTX64.EFI ~/mnt/esp/EFI/BOOT/BOOTX64.EFI

            diskutil unmountDisk /dev/disk4
- èµ·å‹•é †ã®æ•´ç†

    1.PCèµ·å‹•-> 2.BIOSèµ·å‹• ->3.ãƒã‚¤ãƒŠãƒªã‚³ãƒ¼ãƒ‰/ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ç­‰ã®BIOSã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
    

### Cè¨€èªã§hello,world
#### ã¾ãšã¯é–‹ç™ºç’°å¢ƒã‚’æ•´å‚™
1. Clang / NASM / iasl / python ãªã©ã‚’å…¥ã‚Œã‚‹
2. LLVM7 ã‚’ alternatives ã§ clang ã«ã™ã‚‹ï¼ˆUbuntuç‰¹æœ‰ï¼‰
3. EDK II ã‚’ $HOME/edk2 ã« clone
4. OSæœ¬ç”¨ã® ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸€å¼
(x86_64-elf/) ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

ğŸ‘‰ macOS ã§ã¯ 2 ã¯ä¸è¦ã€1ãƒ»3ãƒ»4 ã‚’æ‰‹ã§ã‚„ã‚‹ã€‚â‡©

- brew install nasm acpica pythonã—ã¦ã€
NASM        âœ…<br>
iasl        âœ… (acpica)<br>
clang       âœ… Apple clang 17<br>
python3     âœ…<br>
ã‚’ç¢ºèª
- git clone https://github.com/tianocore/edk2.git<br>
cd edk2<br>
git submodule update --init --recursive<br>
make -C BaseTools<br>
source edksetup.sh<br>
build -a X64 -t CLANGPDB -p OvmfPkg/OvmfPkgX64.dsc(build -a X64 -t CLANG -p OvmfPkg/OvmfPkgX64.dsc?)<br>
->Build/OvmfX64/DEBUG_CLANGPDB/FV/OVMF.fdã‚’ç¢ºèª<br>

ä»¥ä¸‹ç¢ºèª
- brew install qemu
- qemu-system-x86_64 --version
- qemu-system-x86_64 \
  -m 2G \
  -bios Build/OvmfX64/DEBUG_CLANGPDB/FV/OVMF.fd
- UEFI ã‚·ã‚§ãƒ«ãŒå‡ºãŸã‚‰æˆåŠŸã€‚





ãƒ€ãƒ¡ãã†...
https://qiita.com/yamoridon/items/4905765cc6e4f320c9b5
ã“ã‚Œãã®ã¾ã¾ã‚„ã£ã¦ã¿ã‚ˆã†
->patch -p1 < mac.patchã¾ã§ã„ã‘ãŸ(ã‚³ãƒ¼ãƒ‰éƒ¨åˆ†ã¯ã€ã‚³ãƒ”ãƒšãƒœã‚¿ãƒ³ã§ã‚³ãƒ”ãƒ¼ã™ã‚‹ã¨å´©ã‚Œã¦ã‚¨ãƒ©ãƒ¼ã™ã‚‹ã®ã§é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼ã—ã¾ã—ã‚‡ã†)
->HOMEã«ç’°å¢ƒæ•´å‚™(osbook,sdk2)+workspaceä½œæˆ
->Qemuã§Hello,WorldæˆåŠŸ